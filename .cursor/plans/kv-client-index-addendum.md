# Дополнение к плану KV: клиент (index) и работа с kvBuckets

## Контекст

Файл `index.ts` сервиса (например, `examples/MathService/index.ts`) экспортирует **клиент** этого сервиса и импортируется другими сервисами (например, LogicService импортирует MathService как клиент). Поэтому клиент должен поддерживать KV так же, как и остальные части схемы (events, Ref).

## Что добавить в план

### 1. ClientParam и Client

- В **ClientParam** ([`src/interfaces.ts`](src/interfaces.ts)) добавить опциональное поле **kvBuckets?: KvBuckets** (тот же тип, что и в ServiceOptions).
- В конструкторе **Client** ([`src/Client.ts`](src/Client.ts)) принимать `kvBuckets` из параметра и сохранять в приватном поле (например, `this.kvBuckets`), по аналогии с `events` и `Ref`. На текущем этапе клиент не выполняет операций с KV (get/put/watch — это серверная часть), но конфиг из схемы передаётся для согласованности и возможного использования в будущем (например, кодогенерация или хелперы).

### 2. Index-файл (клиент сервиса)

- В каждом index-файле, который экспортирует клиент и использует схему, при наличии в схеме секции **kvBuckets**:
  - Импортировать **kvBuckets** из `service.schema.json` вместе с `name`, `methods`, `events`, `Ref`.
  - Передавать **kvBuckets** в вызов `super()` при создании клиента:  
    `super({ broker, serviceName: name, baggage, cache, events, Ref, kvBuckets })`.
- Так клиент остаётся синхронизированным со схемой: при добавлении kvBuckets в схему кодогенерация (nsc-cli) или ручное обновление index добавит передачу kvBuckets, и другой сервис, импортирующий этот клиент, будет получать клиент с полным конфигом.

### 3. Документация и примеры

- В README в разделе про Client указать, что при использовании схемы с **kvBuckets** нужно импортировать и передавать **kvBuckets** в параметры клиента (как для events и Ref).
- В примере сервиса с KV (KvService или расширенный LogicService) index-файл должен демонстрировать:  
  `import { name, methods, events, Ref, kvBuckets } from './service.schema.json'` и передачу kvBuckets в `super()`.

## Итог

Клиент (index) «работает с kv» за счёт того, что: (1) ClientParam и Client принимают и хранят kvBuckets; (2) index-файл импортирует kvBuckets из схемы и передаёт их в конструктор клиента. Это сохраняет единый контракт схемы для сервиса и его клиента.
